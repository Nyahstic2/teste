<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulação de Janelas Multi-Funcionais</title>
  <style>
    /* Estilização Global */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      overflow: hidden;
      height: 100vh;
    }
    .window {
      position: absolute;
      width: 300px;
      height: 200px;
      border: 1px solid #888;
      background: #fff;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
      border-radius: 8px;
      overflow: hidden;
      transition: opacity 0.3s ease;
    }
    .title-bar {
      background: linear-gradient(90deg, #3498db, #2980b9);
      color: #fff;
      padding: 8px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
      font-weight: bold;
    }
    .title-buttons {
      display: flex;
      gap: 5px;
    }
    .title-buttons button {
      border: none;
      color: #fff;
      width: 20px;
      height: 20px;
      cursor: pointer;
      border-radius: 50%;
      font-weight: bold;
      line-height: 18px;
      padding: 0;
      transition: background 0.2s ease;
    }
    .title-buttons button.minimize {
      background: #f1c40f;
    }
    .title-buttons button.minimize:hover {
      background: #f39c12;
    }
    .title-buttons button.close {
      background: #e74c3c;
    }
    .title-buttons button.close:hover {
      background: #c0392b;
    }
    .window-content {
      padding: 10px;
      height: calc(100% - 40px);
      overflow: auto;
    }
    /* Taskbar */
    #taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: #333;
      display: flex;
      align-items: center;
      padding: 0 10px;
      z-index: 1000;
    }
    #addWindow {
      background: #3498db;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s ease;
    }
    #addWindow:hover {
      background: #2980b9;
    }
    #dateTime {
      margin-left: auto;
      color: #fff;
      font-size: 14px;
    }
    .taskbar-item {
      background: #555;
      color: #fff;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s ease;
      margin-left: 10px;
    }
    .taskbar-item:hover {
      background: #777;
    }
    /* Menu de Adição */
    #addMenu {
      position: absolute;
      background: #fff;
      border: 1px solid #ddd;
      padding: 5px;
      display: none;
      z-index: 1100;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    }
    #addMenu .menu-item {
      cursor: pointer;
      padding: 5px 10px;
    }
    #addMenu .menu-item:hover {
      background: #f0f0f0;
    }
    /* Calculadora */
    .calc-container input[type="text"] {
      width: 100%;
      margin-bottom: 5px;
      font-size: 16px;
      padding: 5px;
    }
    .calc-buttons button {
      width: 23%;
      margin: 1%;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    /* Pedra Papel Tesoura */
    .rps-container {
      text-align: center;
    }
    .rps-container button {
      margin: 5px;
      padding: 10px;
      cursor: pointer;
    }
    .rps-result {
      margin-top: 10px;
      font-weight: bold;
    }
    /* Janela Conectada */
    .chat-area {
      height: 120px;
      overflow: auto;
      border: 1px solid #ddd;
      margin-bottom: 5px;
      padding: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- Taskbar com botão de adicionar e exibição de data/hora -->
  <div id="taskbar">
    <button id="addWindow">Adicionar Janela</button>
    <div id="dateTime"></div>
  </div>
  <!-- Menu de seleção de tipo de janela -->
  <div id="addMenu">
    <div class="menu-item" data-type="connected">Janela Conectada</div>
    <div class="menu-item" data-type="calculator">Calculadora</div>
    <div class="menu-item" data-type="rps">Pedra Papel Tesoura</div>
  </div>

  <script>
    // Variáveis globais
    let currentDragged = null;
    let dragOffsetX = 0, dragOffsetY = 0;
    let highestZIndex = 1;
    let windowCount = 0;
    const taskbar = document.getElementById('taskbar');
    const addWindowBtn = document.getElementById('addWindow');
    const addMenu = document.getElementById('addMenu');
    const dateTimeDiv = document.getElementById('dateTime');

    // Array global para janelas conectadas
    const connectedWindows = [];

    // Atualiza data e hora na taskbar a cada segundo
    function updateDateTime() {
      const now = new Date();
      dateTimeDiv.innerText = now.toLocaleString();
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Função de arraste dos _windows_
    document.addEventListener('mousemove', (e) => {
      if (currentDragged) {
        let newX = e.clientX - dragOffsetX;
        let newY = e.clientY - dragOffsetY;
        newX = Math.max(0, Math.min(newX, window.innerWidth - currentDragged.offsetWidth));
        newY = Math.max(0, Math.min(newY, window.innerHeight - currentDragged.offsetHeight - 40)); // 40px para a taskbar
        currentDragged.style.left = newX + 'px';
        currentDragged.style.top = newY + 'px';
      }
    });
    document.addEventListener('mouseup', () => {
      currentDragged = null;
    });

    // Traz a janela para o topo
    function bringToFront(win) {
      highestZIndex++;
      win.style.zIndex = highestZIndex;
    }

    // Minimiza a janela (cria um botão na taskbar para restauração)
    function minimizeWindow(win) {
      if (win._minimized) return;
      win._minimized = true;
      const winTitle = win.querySelector('.title-bar span').innerText;
      const taskbarButton = document.createElement('button');
      taskbarButton.innerText = winTitle;
      taskbarButton.className = 'taskbar-item';
      taskbarButton.dataset.windowId = win.id;
      taskbarButton.addEventListener('click', () => {
        restoreWindow(win, taskbarButton);
      });
      taskbar.insertBefore(taskbarButton, addWindowBtn.nextSibling);
      win.style.opacity = '0';
      setTimeout(() => {
        win.style.display = 'none';
      }, 300);
    }

    // Restaura a janela minimizada
    function restoreWindow(win, taskbarButton) {
      win.style.display = 'block';
      void win.offsetWidth;
      win.style.opacity = '1';
      if (taskbarButton && taskbarButton.parentNode) {
        taskbarButton.parentNode.removeChild(taskbarButton);
      }
      win._minimized = false;
      bringToFront(win);
    }

    // Fecha a janela e remove-a do array de janelas conectadas (se aplicável)
    function closeWindow(win) {
      const index = connectedWindows.findIndex(conn => conn.id === win.id);
      if (index !== -1) {
        connectedWindows.splice(index, 1);
      }
      if (win.parentNode) win.parentNode.removeChild(win);
    }

    // Aplica os eventos básicos à janela (arraste, minimizar, fechar)
    function applyWindowEvents(win) {
      const titleBar = win.querySelector('.title-bar');
      titleBar.addEventListener('mousedown', (e) => {
        if (e.target.tagName.toLowerCase() === 'button') return;
        currentDragged = win;
        dragOffsetX = e.clientX - win.offsetLeft;
        dragOffsetY = e.clientY - win.offsetTop;
        bringToFront(win);
      });
      
      const btnMinimize = win.querySelector('button.minimize');
      const btnClose = win.querySelector('button.close');
      btnMinimize.addEventListener('click', (e) => {
        e.stopPropagation();
        minimizeWindow(win);
      });
      btnClose.addEventListener('click', (e) => {
        e.stopPropagation();
        closeWindow(win);
      });
    }

    // Função para enviar mensagem aleatória entre as janelas conectadas
    function broadcastMessage(senderId, message) {
      connectedWindows.forEach(conn => {
        const chatArea = conn.chatArea;
        const msgElement = document.createElement('p');
        msgElement.innerText = `Janela ${senderId}: ${message}`;
        chatArea.appendChild(msgElement);
        chatArea.scrollTop = chatArea.scrollHeight;
      });
    }

    /* ---------- Criação das janelas de tipos diferenciados ---------- */

    // 1. Janela Conectada
    function createConnectedWindow() {
      windowCount++;
      const win = document.createElement('div');
      win.className = 'window';
      win.style.top = (50 + 30 * windowCount) + 'px';
      win.style.left = (50 + 30 * windowCount) + 'px';
      win.id = 'window' + windowCount;
      win.innerHTML = `
        <div class="title-bar">
          <span>Janela Conectada ${windowCount}</span>
          <div class="title-buttons">
            <button class="minimize">&#8211;</button>
            <button class="close">&#10005;</button>
          </div>
        </div>
        <div class="window-content">
          <div class="chat-area"></div>
          <button class="send-btn">Enviar Dado Aleatório</button>
        </div>
      `;
      document.body.appendChild(win);
      applyWindowEvents(win);
      bringToFront(win);
      
      // Registra a janela para comunicação
      const chatArea = win.querySelector('.chat-area');
      connectedWindows.push({ id: win.id, chatArea: chatArea });
      
      // Lógica para enviar mensagem aleatória
      const sendBtn = win.querySelector('.send-btn');
      sendBtn.addEventListener('click', () => {
        const randomData = Math.floor(Math.random() * 1000);
        broadcastMessage(win.id, randomData);
      });
    }

    // 2. Calculadora
    function createCalculatorWindow() {
      windowCount++;
      const win = document.createElement('div');
      win.className = 'window';
      win.style.top = (50 + 30 * windowCount) + 'px';
      win.style.left = (50 + 30 * windowCount) + 'px';
      win.id = 'window' + windowCount;
      win.innerHTML = `
        <div class="title-bar">
          <span>Calculadora ${windowCount}</span>
          <div class="title-buttons">
            <button class="minimize">&#8211;</button>
            <button class="close">&#10005;</button>
          </div>
        </div>
        <div class="window-content">
          <div class="calc-container">
            <input type="text" readonly value="0">
            <div class="calc-buttons">
              <button>7</button>
              <button>8</button>
              <button>9</button>
              <button>/</button>
              <button>4</button>
              <button>5</button>
              <button>6</button>
              <button>*</button>
              <button>1</button>
              <button>2</button>
              <button>3</button>
              <button>-</button>
              <button>0</button>
              <button>C</button>
              <button>=</button>
              <button>+</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(win);
      applyWindowEvents(win);
      bringToFront(win);
      
      // Lógica da calculadora
      const display = win.querySelector('input[type="text"]');
      const buttons = win.querySelectorAll('.calc-buttons button');
      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const value = button.innerText;
          if (value === 'C') {
            display.value = '0';
          } else if (value === '=') {
            try {
              display.value = eval(display.value);
            } catch {
              display.value = 'Erro';
            }
          } else {
            if (display.value === '0' || display.value === 'Erro') {
              display.value = value;
            } else {
              display.value += value;
            }
          }
        });
      });
    }

    // 3. Pedra Papel Tesoura
    function createRPSWindow() {
      windowCount++;
      const win = document.createElement('div');
      win.className = 'window';
      win.style.top = (50 + 30 * windowCount) + 'px';
      win.style.left = (50 + 30 * windowCount) + 'px';
      win.id = 'window' + windowCount;
      win.innerHTML = `
        <div class="title-bar">
          <span>Pedra Papel Tesoura ${windowCount}</span>
          <div class="title-buttons">
            <button class="minimize">&#8211;</button>
            <button class="close">&#10005;</button>
          </div>
        </div>
        <div class="window-content">
          <div class="rps-container">
            <div>Escolha:</div>
            <button class="rps-btn" data-choice="Pedra">Pedra</button>
            <button class="rps-btn" data-choice="Papel">Papel</button>
            <button class="rps-btn" data-choice="Tesoura">Tesoura</button>
            <div class="rps-result"></div>
          </div>
        </div>
      `;
      document.body.appendChild(win);
      applyWindowEvents(win);
      bringToFront(win);
      
      // Lógica de Pedra Papel Tesoura
      const buttons = win.querySelectorAll('.rps-btn');
      const resultDiv = win.querySelector('.rps-result');
      buttons.forEach(button => {
        button.addEventListener('click', () => {
          const userChoice = button.dataset.choice;
          const choices = ['Pedra', 'Papel', 'Tesoura'];
          const computerChoice = choices[Math.floor(Math.random() * choices.length)];
          let result = '';
          if (userChoice === computerChoice) {
            result = 'Empate!';
          } else if (
            (userChoice === 'Pedra' && computerChoice === 'Tesoura') ||
            (userChoice === 'Papel' && computerChoice === 'Pedra') ||
            (userChoice === 'Tesoura' && computerChoice === 'Papel')
          ) {
            result = 'Você Venceu!';
          } else {
            result = 'Você Perdeu!';
          }
          resultDiv.innerText = `Você: ${userChoice} | Computador: ${computerChoice} => ${result}`;
        });
      });
    }

    /* ---------- Lógica do menu de "Adicionar Janela" ---------- */
    addWindowBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      if (addMenu.style.display === 'block') {
        addMenu.style.display = 'none';
      } else {
        // Posiciona o menu logo abaixo do botão
        const rect = addWindowBtn.getBoundingClientRect();
        addMenu.style.top = rect.bottom + 'px';
        addMenu.style.left = rect.left + 'px';
        addMenu.style.display = 'block';
      }
    });
    addMenu.addEventListener('click', (e) => e.stopPropagation());
    document.addEventListener('click', () => {
      addMenu.style.display = 'none';
    });
    const menuItems = addMenu.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
      item.addEventListener('click', () => {
        const type = item.dataset.type;
        if (type === 'connected') {
          createConnectedWindow();
        } else if (type === 'calculator') {
          createCalculatorWindow();
        } else if (type === 'rps') {
          createRPSWindow();
        }
        addMenu.style.display = 'none';
      });
    });
  </script>
</body>
</html>
